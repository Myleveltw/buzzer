<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Moderator</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
  margin:0;
  background:black;
  color:white;
  font-family:Segoe UI,sans-serif;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}

/* Bild */
#quizImage{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:contain;
  display:none;
  z-index:1;
}

/* Gewinner */
#winner{
  z-index:2;
  text-align:center;
  display:none;
}
#winner h1{
  font-size:90px;
  margin:0;
}

/* Ranking */
#rankingBox{
  position:absolute;
  top:10%;
  background:#000;
  padding:30px 50px;
  border-radius:25px;
  display:none;
  z-index:3;
}
#rankingBox h2{
  font-size:40px;
  margin-top:0;
  text-align:center;
}
#rankingList div{
  font-size:28px;
  margin:8px 0;
}

/* Punkt Animation */
#pointAnim{
  position:absolute;
  bottom:10%;
  font-size:48px;
  color:gold;
  display:none;
  z-index:4;
  animation:pop .6s ease-out;
}

@keyframes pop{
  from{transform:scale(.6);opacity:0}
  to{transform:scale(1);opacity:1}
}
</style>
</head>

<body>

<img id="quizImage">

<div id="winner">
  <h1 id="winnerName">---</h1>
</div>

<div id="rankingBox">
  <h2>ðŸ“Š Punktestand</h2>
  <div id="rankingList"></div>
</div>

<div id="pointAnim"></div>

<script>
firebase.initializeApp({
  databaseURL:"https://wsmds-9a390-default-rtdb.europe-west1.firebasedatabase.app"
});
const db=firebase.database();

const quizImage=document.getElementById("quizImage");
const winnerDiv=document.getElementById("winner");
const winnerName=document.getElementById("winnerName");
const rankingBox=document.getElementById("rankingBox");
const rankingList=document.getElementById("rankingList");
const pointAnim=document.getElementById("pointAnim");

/* ðŸ”´ BUZZ â€“ DAS IST DAS WICHTIGSTE */
db.ref("buzz").on("value",s=>{
  if(!s.val()){
    winnerDiv.style.display="none";
    return;
  }
  winnerName.textContent=s.val().name;
  winnerDiv.style.display="block";
  quizImage.style.display="none"; // Bild weg beim Buzz
});

/* ðŸŽ® MODUS */
db.ref("settings/mode").on("value",s=>{
  if(s.val()==="image"){
    quizImage.style.display="block";
  }
});

/* ðŸ–¼ï¸ BILD */
db.ref("settings/imageUrl").on("value",s=>{
  if(s.val()) quizImage.src=s.val();
});

/* ðŸ“Š RANKING */
db.ref("settings/showRanking").on("value",s=>{
  rankingBox.style.display=s.val()?"block":"none";
});

db.ref("players").on("value",s=>{
  if(!s.val())return;
  const arr=Object.values(s.val()).map(p=>({
    name:p.name||"Spieler",
    points:p.points||0
  })).sort((a,b)=>b.points-a.points);

  rankingList.innerHTML=arr.map((p,i)=>
    `<div>${i+1}. ${p.name} â€“ ${p.points}</div>`
  ).join("");
});

/* ðŸŽ‰ PUNKT ANIMATION */
db.ref("pointAnimation").on("value",s=>{
  if(!s.val())return;
  pointAnim.textContent=`ðŸŽ‰ ${winnerName.textContent} +1 Punkt`;
  pointAnim.style.display="block";
  setTimeout(()=>pointAnim.style.display="none",1500);
});
</script>

</body>
</html>
