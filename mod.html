<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Moderator</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <style>
    body {
      margin:0;
      background:#0a0a0a;
      color:white;
      font-family:Segoe UI, sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      height:100vh;
      overflow:hidden;
    }

    #winner {
      text-align:center;
      display:none;
    }

    #winner h1 {
      font-size:80px;
      margin:0;
    }

    #winner p {
      font-size:30px;
      opacity:0.8;
    }

    /* Ranking */
    #rankingBox {
      position:absolute;
      top:10%;
      background:#000;
      padding:30px 50px;
      border-radius:25px;
      display:none;
      box-shadow:0 0 40px rgba(0,255,200,0.6);
    }

    #rankingBox h2 {
      margin-top:0;
      font-size:40px;
      text-align:center;
    }

    #rankingList div {
      font-size:28px;
      margin:10px 0;
    }

    /* Punkt Animation */
    #pointAnim {
      position:absolute;
      bottom:12%;
      font-size:48px;
      font-weight:bold;
      color:gold;
      display:none;
      animation: pop 0.6s ease-out;
    }

    @keyframes pop {
      from { transform:scale(0.6); opacity:0; }
      to { transform:scale(1); opacity:1; }
    }
  </style>
</head>

<body>

<!-- Gewinner -->
<div id="winner">
  <h1 id="winnerName">---</h1>
  <p>hat gebuzzert!</p>
</div>

<!-- Punktestand -->
<div id="rankingBox">
  <h2>ðŸ“Š Punktestand</h2>
  <div id="rankingList"></div>
</div>

<!-- Punkt Animation -->
<div id="pointAnim"></div>

<script>
  // ðŸ”§ Firebase Init
  firebase.initializeApp({
    databaseURL: "https://wsmds-9a390-default-rtdb.europe-west1.firebasedatabase.app/"
  });

  const db = firebase.database();

  const winnerDiv = document.getElementById("winner");
  const winnerName = document.getElementById("winnerName");
  const rankingBox = document.getElementById("rankingBox");
  const rankingList = document.getElementById("rankingList");
  const pointAnim = document.getElementById("pointAnim");

  // ðŸŸ¥ Gewinner anzeigen
  db.ref("buzz").on("value", snap => {
    const data = snap.val();
    if (!data) {
      winnerDiv.style.display = "none";
      return;
    }

    winnerName.textContent = data.name;
    winnerDiv.style.display = "block";
  });

  // ðŸ“Š Ranking ein / aus
  db.ref("settings/showRanking").on("value", snap => {
    rankingBox.style.display = snap.val() ? "block" : "none";
  });

  // ðŸ“Š Ranking Daten
  db.ref("players").on("value", snap => {
    const players = snap.val();
    if (!players) return;

    const arr = Object.values(players).map(p => ({
      name: p.name || "Unbekannt",
      points: p.points || 0
    }));

    arr.sort((a,b) => b.points - a.points);

    rankingList.innerHTML = arr.map((p,i) =>
      `<div>${i+1}. ${p.name} â€“ ${p.points} Punkte</div>`
    ).join("");
  });

  // ðŸŽ‰ Punkt Animation
  db.ref("pointAnimation").on("value", snap => {
    if (!snap.val()) return;

    const name = winnerName.textContent;
    if (!name || name === "---") return;

    pointAnim.textContent = `ðŸŽ‰ ${name} bekommt +1 Punkt!`;
    pointAnim.style.display = "block";

    setTimeout(() => {
      pointAnim.style.display = "none";
    }, 1500);
  });
</script>

</body>
</html>
